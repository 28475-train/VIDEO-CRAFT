<!DOCTYPE html>

<html lang="ja"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> <title>LOGIN | KIZUNA VIDEO</title> <style> :root { --bg: #fff; --card: #f5f5f7; --text: #1d1d1f; --sub: #86868b; --accent: #0071e3; --border: #d2d2d7; } * { margin: 0; padding: 0; box-sizing: border-box; } body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; } .login-box { width: 95%; max-width: 450px; background: var(--card); padding: 40px 24px; border-radius: 30px; text-align: center; } h2 { font-size: 2.2rem; margin-bottom: 24px; letter-spacing: -0.04em; } input { width: 100%; padding: 18px; border-radius: 14px; border: 1px solid var(--border); margin-bottom: 12px; font-size: 16px; outline: none; } .btn { width: 100%; padding: 18px; background: var(--text); color: #fff; border-radius: 14px; border: none; font-size: 1.1rem; font-weight: 700; cursor: pointer; margin-top: 10px; } #member-area { display: none; width: 95%; max-width: 500px; background: #fff; border: 1px solid var(--border); padding: 40px 24px; border-radius: 30px; } .progress-container { width: 100%; height: 8px; background: #eee; border-radius: 4px; margin: 25px 0; overflow: hidden; } #pbar { width: 0%; height: 100%; background: var(--accent); transition: 2s cubic-bezier(0.2, 1, 0.3, 1); } .status-badge { display: inline-block; padding: 4px 12px; background: var(--card); border-radius: 20px; font-size: 0.8rem; font-weight: 700; color: var(--accent); margin-bottom: 10px; } #error { color: #ff3b30; font-size: 0.85rem; margin-top: 15px; display: none; } #loading-overlay { display: none; margin-top: 15px; font-size: 0.9rem; color: var(--sub); } </style> </head> <body>

<div id="login-form" class="login-box">
    <span style="font-weight:700; color:var(--accent); letter-spacing:0.1em; display:block; margin-bottom:10px; font-size:0.75rem;">CLIENT PORTAL</span>
    <h2>Sign In</h2>
    <input type="text" id="uid" placeholder="ID (video-1234)">
    <input type="password" id="ups" placeholder="パスワード">
    <button onclick="login()" id="login-btn" class="btn">Continue</button>
    <div id="loading-overlay">照合中...</div>
    <p id="error">IDまたはパスワードが正しくありません</p>
    <a href="contact.html" style="display:block; margin-top:25px; font-size:0.8rem; color:var(--sub); text-decoration:none;">ID発行はこちら</a>
</div>

<div id="member-area">
    <span class="status-badge">PRODUCTION STATUS</span>
    <h2 id="unm">Welcome</h2>
    
    <div class="progress-container">
        <div id="pbar"></div>
    </div>
    
    <div style="display: flex; justify-content: space-between; margin-bottom: 30px;">
        <div>
            <p style="font-size:0.75rem; color:var(--sub); font-weight:700;">ステータス</p>
            <p id="pmsg" style="font-weight:700;"></p>
        </div>
        <div style="text-align: right;">
            <p style="font-size:0.75rem; color:var(--sub); font-weight:700;">納品予定日</p>
            <p id="pdate" style="font-weight:700;"></p>
        </div>
    </div>

    <div style="background: var(--card); padding: 20px; border-radius: 18px; margin-bottom: 20px;">
        <p style="font-size:0.75rem; color:var(--sub); font-weight:700; margin-bottom:5px;">メッセージ</p>
        <p id="pdet" style="font-size:0.95rem;"></p>
    </div>

    <div id="download-area" style="display:none;">
        <a id="purl" href="#" target="_blank" class="btn" style="display:block; text-align:center; background:var(--accent); text-decoration:none;">動画をダウンロード</a>
    </div>

    <button onclick="location.reload()" class="btn" style="margin-top:30px; background:none; color:var(--sub); border:1px solid var(--border);">Logout</button>
</div>

<script>
    const GAS_URL = "[https://script.google.com/macros/s/AKfycbyk4UfoV3D4PD6-Rw0HN_OHD3RszUDsYCKK6g54c3kvP_2SyikX_Kjs1sYCcj4ZODm16w/exec](https://script.google.com/macros/s/AKfycbyk4UfoV3D4PD6-Rw0HN_OHD3RszUDsYCKK6g54c3kvP_2SyikX_Kjs1sYCcj4ZODm16w/exec)";

    async function login() {
        const id = document.getElementById('uid').value;
        const ps = document.getElementById('ups').value;
        const err = document.getElementById('error');
        const btn = document.getElementById('login-btn');
        const loading = document.getElementById('loading-overlay');

        if(!id || !ps) return;

        err.style.display = 'none';
        loading.style.display = 'block';
        btn.disabled = true;

        try {
            // GASから全データを取得
            const response = await fetch(GAS_URL);
            const data = await response.json();

            // シートのIDとパスワードを照合
            // 画像に基づき A列:ID, B列:パスワード, C列:進捗率...
            const user = data.find(row => row.id === id && row.pass === ps);

            if (user) {
                document.getElementById('login-form').style.display = 'none';
                document.getElementById('member-area').style.display = 'block';
                
                document.getElementById('unm').innerText = "ID: " + user.id;
                document.getElementById('pmsg').innerText = user.status || "確認中";
                document.getElementById('pdate').innerText = user.date || "未定";
                document.getElementById('pdet').innerText = user.message || "しばらくお待ち下さい";
                
                // 進捗バーの反映
                setTimeout(() => { 
                    document.getElementById('pbar').style.width = (user.progress || 0) + "%"; 
                }, 100);

                // 納品URLがある場合はボタンを表示
                if(user.url && user.url !== "") {
                    document.getElementById('download-area').style.display = 'block';
                    document.getElementById('purl').href = user.url;
                }
            } else {
                err.style.display = 'block';
            }
        } catch (e) {
            console.error(e);
            alert("データの取得に失敗しました。時間をおいて再度お試しください。");
        } finally {
            loading.style.display = 'none';
            btn.disabled = false;
        }
    }
</script>
</body> </html>
