<!DOCTYPE html>

<html lang="ja"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> <title>LOGIN | KIZUNA VIDEO</title> <style> :root { --bg: #ffffff; --card: #f5f5f7; --text: #1d1d1f; --sub: #86868b; --accent: #0071e3; --border: #d2d2d7; }

    @media (prefers-color-scheme: dark) {
        :root {
            --bg: #000000;
            --card: #1c1c1e;
            --text: #f5f5f7;
            --sub: #a1a1a6;
            --border: #38383a;
        }
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
        background-color: var(--bg);
        color: var(--text);
        font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        overflow-x: hidden;
    }

    .login-card {
        width: 100%;
        max-width: 400px;
        padding: 40px 30px;
        background: var(--card);
        border-radius: 32px;
        text-align: center;
        transition: 0.5s cubic-bezier(0.2, 1, 0.3, 1);
    }

    .nav-logo {
        font-weight: 800;
        font-size: 1.2rem;
        margin-bottom: 30px;
        display: block;
        text-decoration: none;
        color: var(--text);
    }

    input {
        width: 100%;
        padding: 18px;
        margin-bottom: 15px;
        border-radius: 14px;
        border: 1px solid var(--border);
        background: var(--bg);
        color: var(--text);
        font-size: 1rem;
        outline: none;
    }

    .btn-login {
        width: 100%;
        padding: 18px;
        background: var(--text);
        color: var(--bg);
        border: none;
        border-radius: 14px;
        font-weight: 700;
        font-size: 1rem;
        cursor: pointer;
        transition: 0.3s;
    }

    .btn-login:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    #error-message {
        color: #ff3b30;
        font-size: 0.8rem;
        margin-top: 15px;
        min-height: 1.2em;
    }

    /* ログイン後のダッシュボード */
    #dashboard {
        display: none;
        width: 100%;
        max-width: 600px;
        padding: 40px 20px;
    }

    .status-box {
        background: var(--card);
        padding: 30px;
        border-radius: 28px;
        margin-top: 20px;
    }

    .progress-bar {
        width: 100%;
        height: 8px;
        background: var(--border);
        border-radius: 4px;
        margin: 20px 0;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: var(--accent);
        width: 0%;
        transition: 1s cubic-bezier(0.4, 0, 0.2, 1);
    }
</style>
</head> <body>

<div id="login-form" class="login-card">
    <a href="index.html" class="nav-logo">KIZUNA VIDEO</a>
    <h2 style="margin-bottom: 20px; font-size: 1.5rem;">CLIENT LOGIN</h2>
    <input type="text" id="login-id" placeholder="プロジェクトID">
    <input type="password" id="login-pass" placeholder="パスワード">
    <button id="login-btn" class="btn-login" onclick="login()">ログイン</button>
    <p id="error-message"></p>
    <a href="index.html" style="display: block; margin-top: 20px; font-size: 0.8rem; color: var(--sub); text-decoration: none;">ホームへ戻る</a>
</div>

<div id="dashboard">
    <header style="text-align: center; margin-bottom: 40px;">
        <h2 id="user-name" style="font-size: 1.8rem; font-weight: 800;"></h2>
        <p style="color: var(--sub);">現在の制作進捗状況</p>
    </header>

    <div class="status-box">
        <p id="current-status" style="font-weight: 700; font-size: 1.1rem;"></p>
        <div class="progress-bar">
            <div id="progress-fill" class="progress-fill"></div>
        </div>
        <p id="progress-text" style="font-size: 0.8rem; color: var(--sub); text-align: right;"></p>
        
        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border);">
            <p style="font-size: 0.75rem; color: var(--sub); margin-bottom: 10px;">MESSAGE</p>
            <p id="user-message"></p>
        </div>

        <div id="video-area" style="margin-top: 30px; display: none;">
            <p style="font-size: 0.75rem; color: var(--sub); margin-bottom: 10px;">PREVIEW / DOWNLOAD</p>
            <a id="video-url" href="#" target="_blank" style="color: var(--accent); font-weight: 700; text-decoration: none;">動画を確認する</a>
        </div>
    </div>
    
    <button onclick="location.reload()" style="display: block; margin: 40px auto; background: none; border: none; color: var(--sub); cursor: pointer;">ログアウト</button>
</div>

<script>
    // 【重要】あなたのGASのURLに書き換えてください
    const GAS_URL = "https://script.google.com/macros/s/AKfycbw9nwkUF7jNO6RVpOpYrZfTykyXGBRbT7grGqQCInzn_DK-BvhLH1clCD53nvWbBY5-OQ/exec";

    async function login() {
        const idInput = document.getElementById('login-id').value;
        const passInput = document.getElementById('login-pass').value;
        const errorMsg = document.getElementById('error-message');
        const loginBtn = document.getElementById('login-btn');

        if (!idInput || !passInput) {
            errorMsg.innerText = "IDとパスワードを入力してください";
            return;
        }

        errorMsg.style.color = "var(--sub)";
        errorMsg.innerText = "通信中...";
        loginBtn.disabled = true;

        try {
            // 通信エラー対策：キャッシュを防ぐためのタイムスタンプ付与
            const response = await fetch(GAS_URL + "?t=" + new Date().getTime());
            if (!response.ok) throw new Error();
            
            const data = await response.json();
            const user = data.find(u => String(u.id) === idInput && String(u.pass) === passInput);

            if (user) {
                showDashboard(user);
            } else {
                errorMsg.style.color = "#ff3b30";
                errorMsg.innerText = "IDまたはパスワードが正しくありません";
                loginBtn.disabled = false;
            }
        } catch (error) {
            errorMsg.style.color = "#ff3b30";
            errorMsg.innerText = "通信エラーが発生しました。設定（全員への公開）を確認してください。";
            loginBtn.disabled = false;
        }
    }

    function showDashboard(user) {
        document.getElementById('login-form').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
        
        document.getElementById('user-name').innerText = user.name;
        document.getElementById('current-status').innerText = user.status;
        document.getElementById('user-message').innerText = user.message;
        
        const progress = parseInt(user.progress) || 0;
        document.getElementById('progress-fill').style.width = progress + "%";
        document.getElementById('progress-text').innerText = progress + "% 完了";

        if (user.url && user.url !== "") {
            document.getElementById('video-area').style.display = 'block';
            document.getElementById('video-url').href = user.url;
        }
    }
</script>
</body> </html>
